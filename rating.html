<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nova Coin ‚Ä¢ –†–µ–π—Ç–∏–Ω–≥</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .rating-container { padding: 20px; margin-bottom: 80px; }
        .rating-tabs {
            display: flex;
            gap: 10px;
            background: #231334;
            padding: 6px;
            border-radius: 50px;
            margin: 20px 0;
        }
        .rating-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            border-radius: 40px;
            cursor: pointer;
            color: #bba5e0;
            font-weight: 700;
            transition: 0.2s;
        }
        .rating-tab.active {
            background: #9d4edd;
            color: white;
        }
        .rating-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .rating-player {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #2a1a3f;
            border-radius: 60px;
            padding: 15px 20px;
            border: 2px solid #b47aff;
        }
        .rating-avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: #9d4edd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            font-weight: 800;
            color: white;
            text-transform: uppercase;
        }
        .rating-info { flex: 1; }
        .rating-name {
            font-size: 18px;
            font-weight: 700;
        }
        .rating-value {
            color: #ffd966;
            font-size: 20px;
            font-weight: 800;
        }
        .rating-position {
            font-size: 24px;
            font-weight: 800;
            color: #bba5ff;
            width: 50px;
            text-align: center;
        }
        .top-1 { 
            background: linear-gradient(145deg, #4a2e6a, #b886ff);
            border: 3px solid gold;
        }
        .top-2 { border: 3px solid silver; }
        .top-3 { border: 3px solid #cd7f32; }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #bba5ff;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div style="padding: 20px;">
        <h2 style="display: flex; align-items: center; gap: 10px;">
            <span class="icon icon-trophy" style="background: white; width: 32px; height: 32px;"></span>
            –†–ï–ô–¢–ò–ù–ì –ò–ì–†–û–ö–û–í
        </h2>
    </div>

    <div class="rating-container">
        <div class="rating-tabs">
            <div class="rating-tab active" onclick="switchRating('balance')">üí∞ –ë–∞–ª–∞–Ω—Å</div>
            <div class="rating-tab" onclick="switchRating('income')">‚ö° –î–æ—Ö–æ–¥/—Å–µ–∫</div>
            <div class="rating-tab" onclick="switchRating('click')">üëÜ –°–∏–ª–∞ –∫–ª–∏–∫–∞</div>
        </div>

        <div class="rating-list" id="ratingList">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...</div>
        </div>
    </div>

    <div class="nav-bar">
        <a href="index.html" class="nav-item">üè† –ì–ª–∞–≤–Ω–∞—è</a>
        <a href="shop.html" class="nav-item">üõí –ú–∞–≥–∞–∑–∏–Ω</a>
        <a href="games.html" class="nav-item">üéÆ –ò–≥—Ä—ã</a>
        <a href="rating.html" class="nav-item active">üèÜ –†–µ–π—Ç–∏–Ω–≥</a>
        <a href="profile.html" class="nav-item">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="app.js"></script>
    <script>
        let currentRatingType = 'balance';
        let allPlayers = [];

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞
        async function loadRating(type = 'balance') {
            document.getElementById('ratingList').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            
            try {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
                // fetch('/api/top_users?type=' + type)
                
                // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ + —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
                allPlayers = [
                    { id: '1', name: '–ê–Ω—Ç–æ–Ω', balance: 12500, perSec: 0.42, perClick: 12.5 },
                    { id: '2', name: 'Gustavo', balance: 8700, perSec: 0.38, perClick: 9.3 },
                    { id: '3', name: 'Emelevskaya', balance: 5400, perSec: 0.31, perClick: 7.8 },
                    { id: '4', name: '–ú–∏–∂–≥–∞–Ω', balance: 3200, perSec: 0.27, perClick: 5.2 },
                    { id: '5', name: '–õ–µ–Ω–∞', balance: 2100, perSec: 0.19, perClick: 3.7 },
                    { id: userId, name: userData?.first_name || '–í—ã', balance: userData?.balance || 500, 
                      perSec: userData?.perSec || 0.054, perClick: (userData?.perClick * userData?.clickMultiplier) || 0.056 }
                ];
                
                renderRating(type);
            } catch (e) {
                document.getElementById('ratingList').innerHTML = '<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
        function renderRating(type) {
            let sorted = [...allPlayers];
            
            if (type === 'balance') {
                sorted.sort((a, b) => b.balance - a.balance);
            } else if (type === 'income') {
                sorted.sort((a, b) => b.perSec - a.perSec);
            } else {
                sorted.sort((a, b) => b.perClick - a.perClick);
            }
            
            let html = '';
            sorted.slice(0, 15).forEach((player, index) => {
                let placeClass = '';
                if (index === 0) placeClass = 'top-1';
                else if (index === 1) placeClass = 'top-2';
                else if (index === 2) placeClass = 'top-3';
                
                let value = '';
                if (type === 'balance') value = player.balance.toFixed(2) + ' NC';
                else if (type === 'income') value = '+' + player.perSec.toFixed(3) + '/—Å–µ–∫';
                else value = '+' + player.perClick.toFixed(3) + '/–∫–ª–∏–∫';
                
                let isCurrentUser = player.id == userId;
                
                html += `
                    <div class="rating-player ${placeClass}">
                        <div class="rating-avatar">${player.name.charAt(0)}</div>
                        <div class="rating-info">
                            <div class="rating-name" style="${isCurrentUser ? 'color: ' + (userData?.nameColor || '#ffd966') : ''}">
                                ${player.name} ${isCurrentUser ? '(–í—ã)' : ''}
                            </div>
                            <div class="rating-value">${value}</div>
                        </div>
                        <div class="rating-position">#${index + 1}</div>
                    </div>
                `;
            });
            
            document.getElementById('ratingList').innerHTML = html;
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        window.switchRating = function(type) {
            document.querySelectorAll('.rating-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            currentRatingType = type;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
            let currentPlayer = allPlayers.find(p => p.id == userId);
            if (currentPlayer && userData) {
                currentPlayer.balance = userData.balance;
                currentPlayer.perSec = userData.perSec;
                currentPlayer.perClick = userData.perClick * userData.clickMultiplier;
                currentPlayer.name = userData.first_name;
            }
            
            renderRating(type);
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        document.addEventListener('DOMContentLoaded', () => {
            // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ userData
            let checkInterval = setInterval(() => {
                if (userData) {
                    clearInterval(checkInterval);
                    loadRating('balance');
                }
            }, 100);
        });
    </script>
</body>
</html>